name: Pinterest RSS Sync

on:
  workflow_dispatch:
  schedule:
    - cron: "0 */12 * * *"

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Fetch Pinterest RSS
        run: |
          curl -L "https://www.pinterest.com/codychukwuebuka/feed.rss" -o feed.xml

      - name: Convert RSS to JSON
        run: |
          node -e "
          const fs = require('fs');
          const xml = fs.readFileSync('feed.xml','utf8');
          const matches = [...xml.matchAll(/<item>[\\s\\S]*?<link>(.*?)<\\/link>[\\s\\S]*?<img src=\\\"(.*?)\\\"/g)];
          const data = matches.slice(0,8).map(m => ({
            image: m[2].replace('/236x/', '/736x/'),
            link: m[1],
            title: 'Pinterest Pin'
          }));
          fs.writeFileSync('pinterest.json', JSON.stringify(data, null, 2));
          "

      - name: Commit and push
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions@github.com"
          git add .
          git commit -m "Update Pinterest feed" || echo "No changes to commit"
          git push
