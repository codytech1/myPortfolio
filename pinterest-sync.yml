const fs = require("fs");

const xml = fs.readFileSync("feed.xml", "utf8");

const items = [...xml.matchAll(/<item>([\s\S]*?)<\/item>/g)]
  .slice(0, 8)
  .map(match => {
    const block = match[1];

    const title =
      (block.match(/<title><!\[CDATA\[(.*?)\]\]><\/title>/) ||
       block.match(/<title>(.*?)<\/title>/) ||
       [])[1];

    const link = (block.match(/<link>(.*?)<\/link>/) || [])[1];

    const description =
      (block.match(/<description><!\[CDATA\[([\s\S]*?)\]\]><\/description>/) ||
       [])[1];

    if (!description) return null;

    const img =
      (description.match(/<img.*?src="(.*?)"/) || [])[1];

    if (!img || !link) return null;

    return {
      title: title || "Pinterest Pin",
      image: img,
      url: link
    };
  })
  .filter(Boolean);

fs.writeFileSync(
  "pinterest.json",
  JSON.stringify(items, null, 2)
);
